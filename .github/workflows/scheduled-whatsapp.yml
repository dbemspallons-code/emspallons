name: Scheduled WhatsApp Relance

on:
  schedule:
    - cron: '0 9 * * *'  # every day at 09:00 UTC

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Call Netlify function to trigger WhatsApp relay
        env:
          NETLIFY_SITE_URL: ${{ secrets.NETLIFY_SITE_URL }}
          SCHEDULED_JOB_SECRET: ${{ secrets.SCHEDULED_JOB_SECRET }}
        run: |
          curl -s -X POST "$NETLIFY_SITE_URL/.netlify/functions/send-whatsapp-twilio" \
            -H "Content-Type: application/json" \
            -H "X-SCHEDULED-SECRET: $SCHEDULED_JOB_SECRET" \
            -d '{"limit":50}' \
            | jq -r '.' || true
